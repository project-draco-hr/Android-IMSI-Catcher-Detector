{
  mContext=context;
  mActivity=activity;
  tm=(TelephonyManager)context.getSystemService(Context.TELEPHONY_SERVICE);
  mIMEI=tm.getDeviceId();
  mIMEIV=tm.getDeviceSoftwareVersion();
  mPhoneNum=tm.getLine1Number();
  mPhoneID=tm.getPhoneType();
switch (mPhoneID) {
case TelephonyManager.PHONE_TYPE_GSM:
    mPhoneType="GSM";
  mMmcmcc=tm.getNetworkOperator();
mNetName=tm.getNetworkOperatorName();
GsmCellLocation gsmCellLocation=(GsmCellLocation)tm.getCellLocation();
if (gsmCellLocation != null) {
mCellType="" + gsmCellLocation.getCid();
mLac="" + gsmCellLocation.getLac();
}
mSimCountry=tm.getSimCountryIso();
mSimOperator=tm.getSimOperator();
mSimOperatorName=tm.getSimOperatorName();
mSimSerial=tm.getSimSerialNumber();
mSimSubs=tm.getSubscriberId();
break;
case TelephonyManager.PHONE_TYPE_CDMA:
mPhoneType="CDMA";
break;
}
mNetID=getNetID(true);
mNetType=tm.getNetworkTypeName();
int mDataActivity=tm.getDataActivity();
mDataActivityType=getActivityDesc(mDataActivity);
mDataActivity=tm.getDataState();
mDataState=getStateDesc(mDataActivity);
dbHelper=new AIMSICDDbAdapter(mContext);
mSignalListenerLocation=new PhoneStateListener(){
public void onCellLocationChanged(CellLocation location){
mNetID=getNetID(true);
mNetType=tm.getNetworkTypeName();
int dataActivityType=tm.getDataActivity();
String dataActivity="un";
switch (dataActivityType) {
case TelephonyManager.DATA_ACTIVITY_NONE:
dataActivity="No";
break;
case TelephonyManager.DATA_ACTIVITY_IN:
dataActivity="In";
break;
case TelephonyManager.DATA_ACTIVITY_OUT:
dataActivity="Ou";
break;
case TelephonyManager.DATA_ACTIVITY_INOUT:
dataActivity="IO";
break;
case TelephonyManager.DATA_ACTIVITY_DORMANT:
dataActivity="Do";
break;
}
int dataType=tm.getDataState();
String dataState="un";
switch (dataType) {
case TelephonyManager.DATA_DISCONNECTED:
dataState="Di";
break;
case TelephonyManager.DATA_CONNECTING:
dataState="Ct";
break;
case TelephonyManager.DATA_CONNECTED:
dataState="Cd";
break;
case TelephonyManager.DATA_SUSPENDED:
dataState="Su";
break;
}
switch (mPhoneID) {
case TelephonyManager.PHONE_TYPE_GSM:
GsmCellLocation gsmCellLocation=(GsmCellLocation)location;
if (gsmCellLocation != null) {
mCellInfo=gsmCellLocation.toString() + dataActivity + "|"+ dataState+ "|"+ mNetType+ "|";
mLacID=gsmCellLocation.getLac();
mCellID=gsmCellLocation.getCid();
dbHelper.open();
if (isTrackingCell() && !dbHelper.cellExists(mCellID)) {
mSimCountry=getSimCountry(true);
mSimOperator=getSimOperator(true);
mSimOperatorName=getSimOperatorName(true);
dbHelper.insertCell(mLacID,mCellID,mNetID,mLatitude,mLongitude,mSignalInfo,mCellInfo,mSimCountry,mSimOperator,mSimOperatorName);
}
}
break;
case TelephonyManager.PHONE_TYPE_CDMA:
CdmaCellLocation cdmaCellLocation=(CdmaCellLocation)location;
if (cdmaCellLocation != null) {
mCellInfo=cdmaCellLocation.toString() + dataActivity + "|"+ dataState+ "|"+ mNetType+ "|";
mLacID=cdmaCellLocation.getNetworkId();
mCellID=cdmaCellLocation.getBaseStationId();
if (isTrackingCell() && !dbHelper.cellExists(mCellID)) {
mSimCountry=getSimCountry(true);
mSimOperator=getSimOperator(true);
mSimOperatorName=getNetworkName(true);
}
}
}
if (TrackingCell && !dbHelper.cellExists(mCellID)) {
dbHelper.insertCell(mLacID,mCellID,mNetID,mLatitude,mLongitude,mSignalInfo,mCellInfo,mSimCountry,mSimOperator,mSimOperatorName);
}
}
}
;
mSignalListenerStrength=new PhoneStateListener(){
public void onSignalStrengthsChanged(SignalStrength signalStrength){
switch (mPhoneID) {
case TelephonyManager.PHONE_TYPE_GSM:
mSignalInfo=signalStrength.getGsmSignalStrength();
break;
case TelephonyManager.PHONE_TYPE_CDMA:
mSignalInfo=signalStrength.getCdmaDbm();
break;
default :
mSignalInfo=0;
}
if (TrackingSignal) {
dbHelper.insertSignal(mLacID,mCellID,mNetID,mLatitude,mLongitude,mSignalInfo,mCellInfo);
}
}
}
;
}
