{
  tm=(TelephonyManager)context.getSystemService(Context.TELEPHONY_SERVICE);
  sIMEI=tm.getDeviceId();
  sIMEIV=tm.getDeviceSoftwareVersion();
  sPhoneNum=tm.getLine1Number();
  sPhoneID=tm.getPhoneType();
switch (sPhoneID) {
case TelephonyManager.PHONE_TYPE_GSM:
    sPhoneType="GSM";
  sMmcmcc=tm.getNetworkOperator();
sNetName=tm.getNetworkOperatorName();
GsmCellLocation gsmCellLocation=(GsmCellLocation)tm.getCellLocation();
if (gsmCellLocation != null) {
sCellType="" + gsmCellLocation.getCid();
sLac="" + gsmCellLocation.getLac();
}
sSimCountry=tm.getSimCountryIso();
sSimOperator=tm.getSimOperator();
sSimOperatorName=tm.getSimOperatorName();
sSimSerial=tm.getSimSerialNumber();
sSimSubs=tm.getSubscriberId();
break;
case TelephonyManager.PHONE_TYPE_CDMA:
sPhoneType="CDMA";
break;
}
sNetID=getNetID(true);
sNetType=tm.getNetworkTypeName();
int sDataActivity=tm.getDataActivity();
sDataActivityType=getActivityDesc(sDataActivity);
sDataActivity=tm.getDataState();
sDataState=getStateDesc(sDataActivity);
dbHelper=new SQLiteHelper(context);
sDB=dbHelper.getWritableDatabase();
sSignalListenerLocation=new PhoneStateListener(){
public void onCellLocationChanged(CellLocation location){
sNetID=getNetID(true);
sNetType=tm.getNetworkTypeName();
int dataActivityType=tm.getDataActivity();
String dataActivity="un";
switch (dataActivityType) {
case TelephonyManager.DATA_ACTIVITY_NONE:
dataActivity="No";
break;
case TelephonyManager.DATA_ACTIVITY_IN:
dataActivity="In";
break;
case TelephonyManager.DATA_ACTIVITY_OUT:
dataActivity="Ou";
break;
case TelephonyManager.DATA_ACTIVITY_INOUT:
dataActivity="IO";
break;
case TelephonyManager.DATA_ACTIVITY_DORMANT:
dataActivity="Do";
break;
}
int dataType=tm.getDataState();
String dataState="un";
switch (dataType) {
case TelephonyManager.DATA_DISCONNECTED:
dataState="Di";
break;
case TelephonyManager.DATA_CONNECTING:
dataState="Ct";
break;
case TelephonyManager.DATA_CONNECTED:
dataState="Cd";
break;
case TelephonyManager.DATA_SUSPENDED:
dataState="Su";
break;
}
switch (sPhoneID) {
case TelephonyManager.PHONE_TYPE_GSM:
GsmCellLocation gsmCellLocation=(GsmCellLocation)location;
if (gsmCellLocation != null) {
sCellInfo=gsmCellLocation.toString() + dataActivity + "|"+ dataState+ "|"+ sNetType+ "|";
sLacID=gsmCellLocation.getLac();
sCellID=gsmCellLocation.getCid();
if (isTrackingCell() && !dbHelper.cellExists(sCellID)) {
sSimCountry=getSimCountry(true);
sSimOperator=getSimOperator(true);
sSimOperatorName=getSimOperatorName(true);
dbHelper.insertCell(sDB,sLacID,sCellID,sNetID,sLatitude,sLongitude,sSignalInfo,sCellInfo,sSimCountry,sSimOperator,sSimOperatorName);
}
}
break;
case TelephonyManager.PHONE_TYPE_CDMA:
CdmaCellLocation cdmaCellLocation=(CdmaCellLocation)location;
if (cdmaCellLocation != null) {
sCellInfo=cdmaCellLocation.toString() + dataActivity + "|"+ dataState+ "|"+ sNetType+ "|";
sLacID=cdmaCellLocation.getNetworkId();
sCellID=cdmaCellLocation.getBaseStationId();
if (isTrackingCell() && !dbHelper.cellExists(sCellID)) {
sSimCountry=getSimCountry(true);
sSimOperator=getSimOperator(true);
sSimOperatorName=getNetworkName(true);
}
}
}
if (TrackingCell && !dbHelper.cellExists(sCellID)) {
dbHelper.insertCell(sDB,sLacID,sCellID,sNetID,sLatitude,sLongitude,sSignalInfo,sCellInfo,sSimCountry,sSimOperator,sSimOperatorName);
}
}
}
;
sSignalListenerStrength=new PhoneStateListener(){
public void onSignalStrengthsChanged(SignalStrength signalStrength){
switch (sPhoneID) {
case TelephonyManager.PHONE_TYPE_GSM:
sSignalInfo=signalStrength.getGsmSignalStrength();
break;
case TelephonyManager.PHONE_TYPE_CDMA:
sSignalInfo=signalStrength.getCdmaDbm();
break;
default :
sSignalInfo=0;
}
if (TrackingSignal) {
dbHelper.insertSignal(sDB,sLacID,sCellID,sNetID,sLatitude,sLongitude,sSignalInfo,sCellInfo);
}
}
}
;
}
