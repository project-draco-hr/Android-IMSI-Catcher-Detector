{
  List<Cell> neighboringCells=new ArrayList<>();
  List<NeighboringCellInfo> neighboringCellInfo;
  neighboringCellInfo=tm.getNeighboringCellInfo();
  if (neighboringCellInfo.size() == 0) {
    neighboringCellBlockingQueue=new LinkedBlockingQueue<>(100);
    Log.i(TAG,"neighbouringCellInfo empty - start polling");
    if (Build.VERSION.SDK_INT > 16) {
      DeviceApi17.startListening(tm,phoneStatelistener);
    }
 else {
      tm.listen(phoneStatelistener,PhoneStateListener.LISTEN_CELL_LOCATION | PhoneStateListener.LISTEN_DATA_CONNECTION_STATE | PhoneStateListener.LISTEN_SERVICE_STATE| PhoneStateListener.LISTEN_SIGNAL_STRENGTHS);
    }
    for (int i=0; i < 10 && neighboringCellInfo.size() == 0; i++) {
      try {
        Log.i(TAG,"neighbouringCellInfo empty - try " + i);
        NeighboringCellInfo info=neighboringCellBlockingQueue.poll(1,TimeUnit.SECONDS);
        if (info == null) {
          neighboringCellInfo=tm.getNeighboringCellInfo();
          if (neighboringCellInfo.size() > 0) {
            Log.i(TAG,"neighbouringCellInfo empty - try " + i + " succeeded time based");
            break;
          }
 else {
            continue;
          }
        }
        ArrayList<NeighboringCellInfo> cellInfoList=new ArrayList<>(neighboringCellBlockingQueue.size() + 1);
        while (info != null) {
          cellInfoList.add(info);
          info=neighboringCellBlockingQueue.poll(1,TimeUnit.SECONDS);
        }
        neighboringCellInfo=cellInfoList;
      }
 catch (      InterruptedException e) {
      }
    }
  }
  Log.i(TAG,"neighbouringCellInfo Size - " + neighboringCellInfo.size());
  for (  NeighboringCellInfo neighbourCell : neighboringCellInfo) {
    Log.i(TAG,"neighbouringCellInfo - CID:" + neighbourCell.getCid() + " LAC:"+ neighbourCell.getLac()+ " RSSI:"+ neighbourCell.getRssi()+ " PSC:"+ neighbourCell.getPsc());
    final Cell cell=new Cell(neighbourCell.getCid(),neighbourCell.getLac(),neighbourCell.getRssi(),neighbourCell.getPsc(),neighbourCell.getNetworkType(),false);
    neighboringCells.add(cell);
  }
  return neighboringCells;
}
