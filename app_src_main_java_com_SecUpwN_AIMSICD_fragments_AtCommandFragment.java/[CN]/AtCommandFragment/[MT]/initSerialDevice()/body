{
  RootShell.handlerEnabled=false;
  boolean root=RootShell.isAccessGiven();
  if (!root) {
    return ROOT_UNAVAILABLE;
  }
  boolean busybox=RootShell.isBusyboxAvailable();
  if (!busybox) {
    return BUSYBOX_UNAVAILABLE;
  }
  try {
    mAtResponse.setText("*** Looking for AT serial devices...\n");
    mSerialDevices.clear();
    try {
      String rilDevice=Helpers.getSystemProp(mContext,"rild.libargs","UNKNOWN");
      mSerialDevice=(rilDevice.equals("UNKNOWN") ? rilDevice : rilDevice.substring(3));
      if (!mSerialDevice.equals("UNKNOWN")) {
        mSerialDevices.add(mSerialDevice);
      }
    }
 catch (    StringIndexOutOfBoundsException e) {
    }
    for (    File file : new File("/dev").listFiles()) {
      String name=file.getName();
      boolean add=false;
      if (name.matches("^smd.$")) {
        add=true;
      }
 else       if (name.equals("radio")) {
        for (        File subfile : file.listFiles()) {
          String subname=subfile.getName();
          if (subname.contains("atci")) {
            add=true;
            file=subfile;
          }
        }
      }
      if (add) {
        mSerialDevices.add(file.getAbsolutePath());
        mAtResponse.append("Found: " + file.getAbsolutePath() + "\n");
      }
    }
    File xgold=new File("/system/etc/ril_xgold_radio.cfg");
    if (xgold.exists() && xgold.isFile()) {
      Command cmd=new Command(1,"\\cat /system/etc/ril_xgold_radio.cfg | " + "\\grep -E \"atport*|dataport*\""){
        @Override public void commandOutput(        int id,        String line){
          if (id == 0) {
            if (!line.trim().equals("") && line.contains("/dev/")) {
              int place=line.indexOf("=") + 1;
              mSerialDevices.add(line.substring(place,line.length() - 1));
              mAtResponse.append("Found: " + line.substring(place,line.length() - 1) + "\n");
            }
          }
          super.commandOutput(id,line);
        }
      }
;
      Shell shell=RootShell.getShell(true);
      shell.add(cmd);
      commandWait(shell,cmd);
    }
  }
 catch (  Exception e) {
    Log.e("AIMSICD","ATCoP: initSerialDevice " + e);
  }
  if (!mSerialDevices.isEmpty()) {
    String[] entries=new String[mSerialDevices.size()];
    entries=mSerialDevices.toArray(entries);
    ArrayAdapter<String> spinnerAdapter=new ArrayAdapter<>(mContext,android.R.layout.simple_spinner_item,entries);
    mSerialDeviceSpinner.setAdapter(spinnerAdapter);
    mSerialDeviceSpinner.setVisibility(View.VISIBLE);
    mSerialDeviceSpinnerLabel.setVisibility(View.VISIBLE);
  }
  mAtResponse.append("*** Setup Complete ***\n");
  mAtResponse.setVisibility(View.VISIBLE);
  return SERIAL_INIT_OK;
}
