{
  RootShell.handlerEnabled=false;
  boolean root=RootShell.isAccessGiven();
  if (!root) {
    return ROOT_UNAVAILABLE;
  }
  boolean busybox=RootShell.isBusyboxAvailable();
  if (!busybox) {
    return BUSYBOX_UNAVAILABLE;
  }
  try {
    shell=RootShell.getShell(true);
    mAtResponse.setText("*** Looking for AT serial devices...\n");
    mSerialDevices.clear();
    String rilDevice=Helpers.getSystemProp(mContext,"rild.libargs","UNKNOWN");
    mSerialDevice=(rilDevice.equals("UNKNOWN") ? rilDevice : rilDevice.substring(3));
    if (!mSerialDevice.equals("UNKNOWN")) {
      mSerialDevices.add(mSerialDevice);
    }
    Command cmd=new Command(0,"\\ls /dev/smd*"){
      @Override public void commandOutput(      int id,      String line){
        if (id == 0) {
          if (!line.trim().equals("") && !mSerialDevices.contains("/dev/" + line.trim())) {
            mSerialDevices.add("/dev/" + line.trim());
            mAtResponse.append("Found: " + line.trim());
          }
        }
        super.commandOutput(id,line);
      }
    }
;
    shell.add(cmd);
    commandWait(shell,cmd);
    File xgold=new File("/system/etc/ril_xgold_radio.cfg");
    if (xgold.exists() && xgold.isFile()) {
      cmd=new Command(1,"cat /system/etc/ril_xgold_radio.cfg | " + "grep -E \"atport*|dataport*\""){
        @Override public void commandOutput(        int id,        String line){
          if (id == 0) {
            if (!line.trim().equals("") && line.contains("/dev/")) {
              int place=line.indexOf("=") + 1;
              mSerialDevices.add(line.substring(place,line.length() - 1));
              mAtResponse.append(line.substring(place,line.length() - 1));
            }
          }
          super.commandOutput(id,line);
        }
      }
;
      shell.add(cmd);
      commandWait(shell,cmd);
    }
  }
 catch (  Exception e) {
    Log.e("AIMSICD","initSerialDevice " + e);
  }
  if (!mSerialDevices.isEmpty()) {
    mSerialDevice=mSerialDevices.get(0);
    setSerialDevice();
    String[] entries=new String[mSerialDevices.size()];
    entries=mSerialDevices.toArray(entries);
    ArrayAdapter<String> spinnerAdapter=new ArrayAdapter<>(mContext,android.R.layout.simple_spinner_item,entries);
    mSerialDeviceSpinner.setAdapter(spinnerAdapter);
    mSerialDeviceSpinner.setVisibility(View.VISIBLE);
    mSerialDeviceSpinnerLabel.setVisibility(View.VISIBLE);
  }
  mAtResponse.append("*** Setup Complete ***\n");
  mAtResponse.setVisibility(View.VISIBLE);
  return SERIAL_INIT_OK;
}
