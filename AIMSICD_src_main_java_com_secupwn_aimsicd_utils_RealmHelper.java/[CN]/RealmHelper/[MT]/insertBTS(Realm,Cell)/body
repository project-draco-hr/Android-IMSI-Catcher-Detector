{
  if (!cellInDbiBts(realm,cell.getLocationAreaCode(),cell.getCid())) {
    realm.beginTransaction();
    BTS bts=realm.createObject(BTS.class);
    bts.setMobileCountryCode(cell.getMcc());
    bts.setMobileNetworkCode(cell.getMnc());
    bts.setLocationAreaCode(cell.getLocationAreaCode());
    bts.setCellId(cell.getCid());
    bts.setPrimaryScramblingCode(cell.getPrimaryScramblingCode());
    bts.setTimeFirst(new Date());
    bts.setTimeLast(new Date());
    LocationInfo locationInfo=realm.createObject(LocationInfo.class);
    locationInfo.setLatitude(cell.getLat());
    locationInfo.setLongitude(cell.getLon());
    bts.setLocationInfo(locationInfo);
    realm.commitTransaction();
  }
 else {
    BTS bts=realm.where(BTS.class).equalTo("cellId",cell.getCid()).findFirst();
    realm.beginTransaction();
    bts.setTimeLast(new Date());
    if (Double.doubleToRawLongBits(cell.getLat()) != 0 && Double.doubleToRawLongBits(cell.getLat()) != 0 && Double.doubleToRawLongBits(cell.getLon()) != 0 && Double.doubleToRawLongBits(cell.getLon()) != 0) {
      if (bts.getLocationInfo() == null) {
        bts.setLocationInfo(realm.createObject(LocationInfo.class));
      }
      bts.getLocationInfo().setLatitude(cell.getLat());
      bts.getLocationInfo().setLongitude(cell.getLon());
    }
    realm.commitTransaction();
    log.info("BTS updated: CID=" + cell.getCid() + " LAC="+ cell.getLocationAreaCode());
  }
  if (!cellInDbiMeasure(realm,cell.getCid())) {
    realm.beginTransaction();
    Measure measure=realm.createObject(Measure.class);
    BTS bts=realm.where(BTS.class).equalTo("cellId",cell.getCid()).findFirst();
    measure.setBts(bts);
    measure.setTime(new Date());
    LocationInfo locationInfo=realm.createObject(LocationInfo.class);
    locationInfo.setLatitude(cell.getLat());
    locationInfo.setLongitude(cell.getLon());
    locationInfo.setAccuracy(cell.getAccuracy());
    measure.setGpsd(locationInfo);
    measure.setRxSignal(cell.getDbm());
    measure.setRadioAccessTechnology(String.valueOf(cell.getRat()));
    measure.setTa(cell.getTimingAdvance());
    measure.setSubmitted(false);
    measure.setNeighbour(false);
    realm.commitTransaction();
    log.info("Measure inserted cellId=" + cell.getCid());
  }
 else {
    realm.beginTransaction();
    RealmResults<Measure> all=realm.where(Measure.class).equalTo("bts.cellId",cell.getCid()).findAll();
    for (    Measure measure : all) {
      if (Double.doubleToRawLongBits(cell.getLat()) != 0 && Double.doubleToRawLongBits(cell.getLon()) != 0) {
        measure.getGpsd().setLatitude(cell.getLat());
        measure.getGpsd().setLongitude(cell.getLon());
      }
      if (Double.doubleToRawLongBits(cell.getAccuracy()) != 0 && cell.getAccuracy() > 0) {
        measure.getGpsd().setAccuracy(cell.getAccuracy());
      }
      if (cell.getDbm() > 0) {
        measure.setRxSignal(cell.getDbm());
      }
      if (cell.getTimingAdvance() > 0) {
        measure.setTa(cell.getTimingAdvance());
      }
    }
    realm.commitTransaction();
    log.info("DBi_measure updated bts_id=" + cell.getCid());
  }
}
