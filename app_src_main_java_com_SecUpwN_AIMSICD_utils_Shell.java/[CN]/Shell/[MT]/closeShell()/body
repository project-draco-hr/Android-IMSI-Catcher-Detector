{
  if (mShellStdIn != null) {
    Log.i(TAG,"Closing shell standard input");
    try {
      mShellStdIn.writeBytes("exit\n");
      mShellStdIn.flush();
      mShellStdIn.close();
    }
 catch (    IOException ioe) {
      Log.i(TAG,"Close shell StdIn - " + ioe.getMessage());
    }
    mShellStdIn=null;
  }
  clearStdOutAndErr();
  if (mShellStdOut != null) {
    Log.i(TAG,"Closing shell standard output");
    try {
      mShellStdOut.close();
    }
 catch (    IOException ioe) {
      Log.i(TAG,"Close shell StdOut - " + ioe.getMessage());
    }
    mShellStdOut=null;
  }
  if (mShellStdErr != null) {
    Log.i(TAG,"Closing shell standard error");
    try {
      mShellStdErr.close();
    }
 catch (    IOException ioe) {
      Log.i(TAG,"Close shell StdErr - " + ioe.getMessage());
    }
    mShellStdErr=null;
  }
  if (mShellProcess != null) {
    try {
      Log.i(TAG,"Waiting for shell exit");
      mShellProcess.waitFor();
    }
 catch (    InterruptedException ie) {
      Log.i(TAG,"Shell exit failed - " + ie.getMessage());
    }
    Log.i(TAG,"Closing shell");
    mShellProcess.destroy();
    mShellProcess=null;
  }
  mShellOpened=false;
  Log.i(TAG,"Shell closed");
}
