{
  if (this.close)   throw new IllegalStateException("Unable to add commands to a closed shell");
  while (this.isCleaning) {
    ;
  }
  this.commands.add(command);
  this.notifyThreads();
  return command;
}
