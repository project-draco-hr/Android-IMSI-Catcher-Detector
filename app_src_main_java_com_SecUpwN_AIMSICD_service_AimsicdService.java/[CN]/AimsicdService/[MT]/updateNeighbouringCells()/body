{
  mNeighboringCells=new ArrayList<>();
  if (Build.VERSION.SDK_INT > 16) {
    List<CellInfo> allCellInfo=tm.getAllCellInfo();
    if (allCellInfo != null) {
      for (      CellInfo cellInfo : allCellInfo) {
        if (cellInfo instanceof CellInfoGsm) {
          CellInfoGsm gsmCellInfo=(CellInfoGsm)cellInfo;
          CellIdentityGsm cellIdentity=gsmCellInfo.getCellIdentity();
          CellSignalStrengthGsm cellSignalStrengthGsm=gsmCellInfo.getCellSignalStrength();
          int dbmLevel=cellSignalStrengthGsm.getDbm();
          Cell cell=new Cell(cellIdentity.getCid(),cellIdentity.getLac(),cellIdentity.getMcc(),cellIdentity.getMnc(),dbmLevel,SystemClock.currentThreadTimeMillis());
          mNeighboringCells.add(cell);
        }
      }
    }
  }
 else {
    List<NeighboringCellInfo> neighboringCellInfo;
    neighboringCellInfo=tm.getNeighboringCellInfo();
    if (neighboringCellInfo != null) {
      for (      NeighboringCellInfo neighbourCell : neighboringCellInfo) {
        if (neighbourCell.getCid() == NeighboringCellInfo.UNKNOWN_CID)         continue;
        int rssi=neighbourCell.getRssi();
        int dbmLevel=0;
        if (rssi != NeighboringCellInfo.UNKNOWN_RSSI) {
          dbmLevel=-113 + 2 * rssi;
        }
        Cell cell=new Cell(neighbourCell.getCid(),neighbourCell.getLac(),mMcc,mMnc,dbmLevel,SystemClock.currentThreadTimeMillis());
        mNeighboringCells.add(cell);
      }
    }
  }
}
