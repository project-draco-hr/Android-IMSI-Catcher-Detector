{
  List<Cell> neighboringCells=new ArrayList<>();
  if (Build.VERSION.SDK_INT > 16) {
    List<CellInfo> allCellInfo=tm.getAllCellInfo();
    if (allCellInfo != null) {
      for (      CellInfo cellInfo : allCellInfo) {
        if (cellInfo instanceof CellInfoGsm) {
          CellIdentityGsm cellIdentity=((CellInfoGsm)cellInfo).getCellIdentity();
          CellSignalStrengthGsm cellSignalStrengthGsm=((CellInfoGsm)cellInfo).getCellSignalStrength();
          if (cellIdentity.getCid() == Integer.MAX_VALUE) {
            continue;
          }
          int dbmLevel=cellSignalStrengthGsm.getDbm();
          final Cell cell=new Cell(cellIdentity.getCid(),cellIdentity.getLac(),cellIdentity.getMcc(),cellIdentity.getMnc(),dbmLevel,SystemClock.currentThreadTimeMillis());
          neighboringCells.add(cell);
        }
 else         if (cellInfo instanceof CellInfoCdma) {
          final CellSignalStrengthCdma cellSignalStrengthCdma=((CellInfoCdma)cellInfo).getCellSignalStrength();
          final CellIdentityCdma cellIdentity=((CellInfoCdma)cellInfo).getCellIdentity();
          if (cellIdentity.getBasestationId() == Integer.MAX_VALUE) {
            continue;
          }
          final Cell cell=new Cell(cellIdentity.getBasestationId(),cellIdentity.getNetworkId(),mDevice.getMCC(),mDevice.getMnc(),cellSignalStrengthCdma.getDbm(),SystemClock.currentThreadTimeMillis());
          neighboringCells.add(cell);
        }
 else         if (cellInfo instanceof CellInfoLte) {
          final CellSignalStrengthLte cellSignalStrengthLte=((CellInfoLte)cellInfo).getCellSignalStrength();
          final CellIdentityLte cellIdentity=((CellInfoLte)cellInfo).getCellIdentity();
          if (cellIdentity.getPci() == Integer.MAX_VALUE) {
            continue;
          }
          final Cell cell=new Cell(cellIdentity.getPci(),cellIdentity.getTac(),cellIdentity.getMcc(),cellIdentity.getMnc(),cellSignalStrengthLte.getDbm(),SystemClock.currentThreadTimeMillis());
          neighboringCells.add(cell);
        }
 else         if (cellInfo instanceof CellInfoWcdma) {
          final CellSignalStrengthWcdma cellSignalStrengthWcdma=((CellInfoWcdma)cellInfo).getCellSignalStrength();
          final CellIdentityWcdma cellIdentity=((CellInfoWcdma)cellInfo).getCellIdentity();
          if (cellIdentity.getCid() == Integer.MAX_VALUE) {
            continue;
          }
          final Cell cell=new Cell(cellIdentity.getCid(),cellIdentity.getLac(),cellIdentity.getMcc(),cellIdentity.getMnc(),cellSignalStrengthWcdma.getDbm(),SystemClock.currentThreadTimeMillis());
          neighboringCells.add(cell);
        }
      }
    }
  }
  if (neighboringCells.size() == 0) {
    List<NeighboringCellInfo> neighboringCellInfo;
    neighboringCellInfo=tm.getNeighboringCellInfo();
    for (    NeighboringCellInfo neighbourCell : neighboringCellInfo) {
      Log.i(TAG,"neighbouringCellInfo - CID:" + neighbourCell.getCid() + " LAC:"+ neighbourCell.getLac()+ " RSSI:"+ neighbourCell.getRssi()+ " PSC:"+ neighbourCell.getPsc());
      int rssi=0;
      if (neighbourCell.getRssi() != NeighboringCellInfo.UNKNOWN_RSSI) {
        rssi=(2 * neighbourCell.getRssi()) - 113;
      }
      final Cell cell=new Cell(neighbourCell.getCid(),neighbourCell.getLac(),mDevice.getMCC(),mDevice.getMnc(),rssi,neighbourCell.getPsc(),SystemClock.currentThreadTimeMillis());
      neighboringCells.add(cell);
    }
  }
  return neighboringCells;
}
