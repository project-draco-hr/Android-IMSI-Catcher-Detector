{
  GeoLocation loc=null;
  Location location=lm.getLastKnownLocation(LocationManager.GPS_PROVIDER);
  if (location != null && (location.getLatitude() != 0.0 && location.getLongitude() != 0.0)) {
    loc=GeoLocation.fromDegrees(location.getLatitude(),location.getLongitude());
  }
 else {
    location=lm.getLastKnownLocation(LocationManager.NETWORK_PROVIDER);
    if (location != null && (location.getLatitude() != 0.0 && location.getLongitude() != 0.0)) {
      loc=GeoLocation.fromDegrees(location.getLatitude(),location.getLongitude());
    }
 else {
      String coords=prefs.getString(context.getString(R.string.data_last_lat_lon),null);
      if (coords != null) {
        String[] coord=coords.split(":");
        loc=GeoLocation.fromDegrees(Double.valueOf(coord[0]),Double.valueOf(coord[1]));
      }
    }
  }
  return loc;
}
